<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>programming | flask框架 | Home of Nadine</title>
<link rel="shortcut icon" href="https://nadineAug.github.io/favicon.ico?v=1710165087728">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://nadineAug.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="programming | flask框架 | Home of Nadine - Atom Feed" href="https://nadineAug.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="学习笔记
参考 https://www.youtube.com/watch?v=L8nQSm2Emlw&amp;list=PLDFBYdF-BxV1G4FBpG1EMyFtbsbZuJOvD&amp;index=5
Lesson 2 第一个..." />
    <meta name="keywords" content="programming" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://nadineAug.github.io">
  <img class="avatar" src="https://nadineAug.github.io/images/avatar.png?v=1710165087728" alt="">
  </a>
  <h1 class="site-title">
    Home of Nadine
  </h1>
  <p class="site-description">
    纳丁小屋
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              programming | flask框架
            </h2>
            <div class="post-info">
              <span>
                2023-04-04
              </span>
              <span>
                11 min read
              </span>
              
                <a href="https://nadineAug.github.io/tag/uY3j4Nlar/" class="post-tag">
                  # programming
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://nadineAug.github.io/post-images/programming-or-flask-kuang-jia.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <h1 id="学习笔记">学习笔记</h1>
<p>参考 https://www.youtube.com/watch?v=L8nQSm2Emlw&amp;list=PLDFBYdF-BxV1G4FBpG1EMyFtbsbZuJOvD&amp;index=5</p>
<h2 id="lesson-2-第一个hello-world程序">Lesson 2 第一个hello world程序</h2>
<h3 id="配置环境">配置环境</h3>
<p>1.创建虚拟环境venv<br>
2.创建requirements.txt，写入待安装的库，使用下述命令安装：</p>
<pre><code>pip install -r requirements.txt
</code></pre>
<p>3.开始写代码</p>
<pre><code class="language-python">from flask import Flask

app = Flask(__name__)

@app.route('/')
def index():
    return 'hello, world'

if __name__ == '__main__':
    app.run()
</code></pre>
<p>注意：<br>
1.如果想更换代码内容后不停止app就能变化，要改为：</p>
<pre><code>app.run(debug=True)
</code></pre>
<p>2.如果想指定端口：</p>
<pre><code>app.run(port=3000)
</code></pre>
<p>3.想在其他机器上访问：</p>
<pre><code>app.run(host=&quot;0.0.0.0&quot;)
</code></pre>
<h2 id="lesson-3-利用render_template渲染界面">Lesson 3 利用render_template渲染界面</h2>
<p>如果想做一些页面的渲染，直接以html形式写入返回结果虽然也可以，但是不好维护，因此可以使用一个render_template的库，实现把html部分放在外部。</p>
<p>基本操作：<br>
1.当前项目目录下创建文件夹templates，创建文件index.html<br>
2.index.html的代码如下</p>
<pre><code class="language-html">&lt;html&gt;
    &lt;head&gt;&lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello world&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>3.app.py的代码修改如下</p>
<pre><code class="language-python">from flask import Flask, render_template

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

if __name__ == '__main__':
    app.run(debug=True, host=&quot;0.0.0.0&quot;, port=3000)
</code></pre>
<p>如果想给页面取名字，可以传参：<br>
app.py要修改index方法：</p>
<pre><code class="language-python">def index():
    title = 'Flask web app'
    return render_template('index.html', title=title)
</code></pre>
<p>index.html要修改：</p>
<pre><code class="language-html">&lt;html&gt;
    &lt;head&gt;&lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello world&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="lesson-4-利用循环和判断语句控制template的渲染">Lesson 4 利用循环和判断语句控制template的渲染</h2>
<p>判断语句实现如果title存在，页面名就为赋值的title，如果不存在则设置为Flask App</p>
<pre><code class="language-html">&lt;html&gt;
    &lt;head&gt;
        {% if title %}
        &lt;title&gt;{{ title }}&lt;/title&gt;
        {% else %}
        &lt;title&gt;Flask App&lt;/title&gt;
        {% endif %}
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello world&lt;/h1&gt;
        &lt;p&gt;{{ title }}&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>循环语句实现循环打印出列表中内容</p>
<pre><code class="language-python">def index():
    paragraphs = ['Section 1', 'Section 2', 'Section 3']
    title = 'Flask web app'
    return render_template('index.html', title=title, data=paragraphs)
</code></pre>
<pre><code class="language-html">&lt;html&gt;
    &lt;head&gt;
        {% if title %}
        &lt;title&gt;{{ title }}&lt;/title&gt;
        {% else %}
        &lt;title&gt;Flask App&lt;/title&gt;
        {% endif %}
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello world&lt;/h1&gt;
        {% for p in data %}
        &lt;p&gt;{{ p }}&lt;/p&gt;
        {% endfor %}
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="lesson-5-模板继承和引用">Lesson 5 模板继承和引用</h2>
<p>在网站中有很多共用的部分，可以把共用的部分存在一个文件里。这种想法可以通过模板继承和模板引用两种方式实现</p>
<h3 id="模板继承">模板继承</h3>
<p>例如共用部分存在文件base.html（父模板</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        {% if title %}
        &lt;title&gt;{{ title }}&lt;/title&gt;
        {% else %}
        &lt;title&gt;Flask App&lt;/title&gt;
        {% endif %}
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h3&gt;&lt;a href=&quot;/&quot;&gt;Flask App&lt;/a&gt;&lt;/h3&gt;
        &lt;hr&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>在index.html中继承</p>
<pre><code class="language-html">{% extends 'base.html' %}
</code></pre>
<p>此外，还可以在子模板中基于父模板进行修改，具体的做法是，在父模板base.html中创建一个block</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        {% if title %}
        &lt;title&gt;{{ title }}&lt;/title&gt;
        {% else %}
        &lt;title&gt;Flask App&lt;/title&gt;
        {% endif %}
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h3&gt;&lt;a href=&quot;/&quot;&gt;Flask App&lt;/a&gt;&lt;/h3&gt;
        &lt;hr&gt;
        {% block content %}
        {% endblock %}
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>在子模板index.html中也添加这个block并直接修改（即重写）</p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
&lt;p&gt;{{ title }}&lt;/p&gt;
{% endblock %}
</code></pre>
<h3 id="模板引用">模板引用</h3>
<p>基于上面的操作，如果想把导航栏代码（当成一个小组件）挪出来挪到navbar.html，在另一个地方通过include导入</p>
<pre><code class="language-html">&lt;h3&gt;&lt;a href=&quot;/&quot;&gt;Flask App&lt;/a&gt;&lt;/h3&gt;
&lt;hr&gt;
</code></pre>
<p>base.html进行引用</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        {% if title %}
        &lt;title&gt;{{ title }}&lt;/title&gt;
        {% else %}
        &lt;title&gt;Flask App&lt;/title&gt;
        {% endif %}
    &lt;/head&gt;
    &lt;body&gt;
        {% include 'navbar.html' %}

        {% block content %}
        {% endblock %}
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="lesson-6-利用flask-bootstrap来优化布局">Lesson 6 利用flask bootstrap来优化布局</h2>
<p>bootstrap 是一个常用的页面布局的框架（现在已经更新叫做bootstrap-flask）https://bootstrap-flask.readthedocs.io/en/stable/basic/#installation</p>
<p>可参考模板：https://getbootstrap.com/docs/4.0/components/navbar/</p>
<h2 id="lesson-7-flask-sqlalchemy简介和创建用户模型">Lesson 7 Flask-SQLAlchemy简介和创建用户模型</h2>
<p>https://flask-sqlalchemy.palletsprojects.com/en/3.0.x/</p>
<p>在flask shell中执行：</p>
<pre><code>&gt;&gt;&gt; from models import db
&gt;&gt;&gt; db.create_all()
&gt;&gt;&gt; from models import User
&gt;&gt;&gt; User.query.all()
[]
&gt;&gt;&gt; user=User(username='A',password='123',email='A@gmail.com') 
&gt;&gt;&gt; db.session.add(user)
&gt;&gt;&gt; db.session.commit()
&gt;&gt;&gt; User.query.all()
[&lt;User A&gt;]
&gt;&gt;&gt; u=User.query.all()
&gt;&gt;&gt; u=u[0]
&gt;&gt;&gt; u.username
'A'
&gt;&gt;&gt; u.password
'123'
如果要删除表
&gt;&gt;&gt; User.query.delete()
1
&gt;&gt;&gt; user.query.all()
[]
&gt;&gt;&gt; db.session.commit()
</code></pre>
<p>报错及方案：<br>
在命令行执行db.create_all()时，报错RuntimeError: Working outside of application context.<br>
https://stackoverflow.com/questions/34122949/working-outside-of-application-context-flask</p>
<p>注意 从这节开始每完成一次就push一次并注明课程，之后可以尝试PR</p>
<h2 id="lesson-8-利用flask-wtf来创建用户注册表单">Lesson 8 利用Flask WTF来创建用户注册表单</h2>
<p>Flask WTF相关：https://flask-wtf.readthedocs.io/en/1.0.x/</p>
<p>Bootstrap NavBar位置问题：https://stackoverflow.com/questions/19733447/bootstrap-navbar-with-left-center-or-right-aligned-items</p>
<p>WTForms相关：https://pythonhosted.org/Flask-Bootstrap/forms.html</p>
<p>bootstrap4中的template总结：https://github.com/hanxue/flask-bootstrap-4/blob/master/flask_bootstrap/templates/bootstrap/wtf.html</p>
<p>参考博主github https://github.com/alphafan/flask-user-auth-example/blob/master/config.py</p>
<h2 id="lesson-9-用flask-wtf有哪些好处">Lesson 9 用Flask WTF有哪些好处</h2>
<p>增加了人机验证部分，但报错“需要网站所有者处理的错误：网站密钥无效”，暂未解决</p>
<h2 id="lesson-10-利用flask-bcrypt来加密数据项">Lesson 10 利用Flask-Bcrypt来加密数据项</h2>
<p>注册后用户信息的读取：</p>
<pre><code>username = form.username.data
email = form.email.data
password = form.password.data
</code></pre>
<p>为了安全需要对数据项加密</p>
<h2 id="lesson-11-判断用户名是否存在于数据库中">Lesson 11 判断用户名是否存在于数据库中</h2>
<p>之前的代码当用户名重复注册时会报错，本节会解决这个问题</p>
<p>补充flash的用法：https://flask.palletsprojects.com/en/2.3.x/patterns/flashing/</p>
<p>可以通过redirect在注册之后跳转到主页</p>
<h2 id="lesson-12-利用flask-login进行用户的登录">Lesson 12 利用flask-login进行用户的登录</h2>
<h2 id="lesson-13-创建一个请求重置密码的界面">Lesson 13 创建一个请求重置密码的界面</h2>
<p>找回密码：输入邮箱，在邮箱重置密码</p>
<p>上一个版本突然报错了，把下面这段注释掉就好了，原因暂不明</p>
<pre><code># if request.args.get('next'):
#     next_page = request.args.get('next')
#     return redirect(url_for(next_page))
</code></pre>
<h2 id="lesson-14-利用flask-mail发送重置密码的邮件">Lesson 14 利用flask mail发送重置密码的邮件</h2>
<p>PyJWT https://pyjwt.readthedocs.io/en/stable/<br>
https://stackoverflow.com/questions/37058567/configure-flask-mail-to-use-gmail<br>
邮箱界面的html参考：https://github.com/alphafan/flask-user-auth-example</p>
<p>https://www.cnblogs.com/w821759016/p/16165040.html<br>
由于安全性较低应用访问权限无法开启，无法发送邮件的问题无法得到有效解决。（留坑）</p>
<p>git graph太难用了。。。入门到放弃</p>
<h2 id="lesson-16-flask-sqlalchemy中的一对多的表格关系数据库">Lesson 16 Flask SQLAlchemy中的一对多的表格关系数据库</h2>
<p>https://flask-sqlalchemy.palletsprojects.com/en/2.x/quickstart/#simple-relationships</p>
<pre><code>&gt;&gt;&gt;from app.models import db
&gt;&gt;&gt; db.create_all()
&gt;&gt;&gt; from app.models import User, Post
&gt;&gt;&gt; u1 = User(username='Alan',password='pwd', email='email@gmail.com')
&gt;&gt;&gt; u1.posts
[]  
&gt;&gt;&gt; u1.posts.append(Post(body='test text 1')) 
&gt;&gt;&gt; u1.posts
[&lt;Post test text 1&gt;]
&gt;&gt;&gt; p2=Post(body='test text 2')
&gt;&gt;&gt; u1.posts.append(p2)
&gt;&gt;&gt; p2.author
&lt;User Alan&gt;


&gt;&gt;&gt; from app.models import User                                     
&gt;&gt;&gt; user
&lt;User linyue&gt;
&gt;&gt;&gt; user.posts
[&lt;Post HELLO&gt;, &lt;Post HELLO&gt;, &lt;Post asdlkaf&gt;, &lt;Post asdafa&gt;, &lt;Post asdafa&gt;, &lt;Post asafasf&gt;]

## Lesson 17 数据库的多对多关系-用户关注和取关

    &gt;&gt;&gt; from app.models import db
    &gt;&gt;&gt; db.create_all()
    &gt;&gt;&gt; from app.models import User
    &gt;&gt;&gt; u1 = User(username='u1',password='p1',email='e1')
    &gt;&gt;&gt; u2 = User(username='u2',password='p1',email='e1') 
    &gt;&gt;&gt; u1.followers
    []
    &gt;&gt;&gt; u1.followered
    Traceback (most recent call last):
    File &quot;&lt;console&gt;&quot;, line 1, in &lt;module&gt;
    AttributeError: 'User' object has no attribute 'followered'
    &gt;&gt;&gt; u1.followed
    []
    &gt;&gt;&gt; u1.followers.append(u2)
    &gt;&gt;&gt; u1.followers
    [&lt;User u2&gt;]
    &gt;&gt;&gt; u2.followed
    [&lt;User u1&gt;]
    &gt;&gt;&gt; u2.followed.remove(u1)
    &gt;&gt;&gt; u1.followers
    []
</code></pre>
<h2 id="lesson-18">Lesson 18</h2>
<p>https://getbootstrap.com/docs/3.3/components/#thumbnails-custom-content</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">学习笔记</a>
<ul>
<li><a href="#lesson-2-%E7%AC%AC%E4%B8%80%E4%B8%AAhello-world%E7%A8%8B%E5%BA%8F">Lesson 2 第一个hello world程序</a>
<ul>
<li><a href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83">配置环境</a></li>
</ul>
</li>
<li><a href="#lesson-3-%E5%88%A9%E7%94%A8render_template%E6%B8%B2%E6%9F%93%E7%95%8C%E9%9D%A2">Lesson 3 利用render_template渲染界面</a></li>
<li><a href="#lesson-4-%E5%88%A9%E7%94%A8%E5%BE%AA%E7%8E%AF%E5%92%8C%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5%E6%8E%A7%E5%88%B6template%E7%9A%84%E6%B8%B2%E6%9F%93">Lesson 4 利用循环和判断语句控制template的渲染</a></li>
<li><a href="#lesson-5-%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF%E5%92%8C%E5%BC%95%E7%94%A8">Lesson 5 模板继承和引用</a>
<ul>
<li><a href="#%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF">模板继承</a></li>
<li><a href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E7%94%A8">模板引用</a></li>
</ul>
</li>
<li><a href="#lesson-6-%E5%88%A9%E7%94%A8flask-bootstrap%E6%9D%A5%E4%BC%98%E5%8C%96%E5%B8%83%E5%B1%80">Lesson 6 利用flask bootstrap来优化布局</a></li>
<li><a href="#lesson-7-flask-sqlalchemy%E7%AE%80%E4%BB%8B%E5%92%8C%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9E%8B">Lesson 7 Flask-SQLAlchemy简介和创建用户模型</a></li>
<li><a href="#lesson-8-%E5%88%A9%E7%94%A8flask-wtf%E6%9D%A5%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%8D%95">Lesson 8 利用Flask WTF来创建用户注册表单</a></li>
<li><a href="#lesson-9-%E7%94%A8flask-wtf%E6%9C%89%E5%93%AA%E4%BA%9B%E5%A5%BD%E5%A4%84">Lesson 9 用Flask WTF有哪些好处</a></li>
<li><a href="#lesson-10-%E5%88%A9%E7%94%A8flask-bcrypt%E6%9D%A5%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E9%A1%B9">Lesson 10 利用Flask-Bcrypt来加密数据项</a></li>
<li><a href="#lesson-11-%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E5%90%8D%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD">Lesson 11 判断用户名是否存在于数据库中</a></li>
<li><a href="#lesson-12-%E5%88%A9%E7%94%A8flask-login%E8%BF%9B%E8%A1%8C%E7%94%A8%E6%88%B7%E7%9A%84%E7%99%BB%E5%BD%95">Lesson 12 利用flask-login进行用户的登录</a></li>
<li><a href="#lesson-13-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%AF%B7%E6%B1%82%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E7%9A%84%E7%95%8C%E9%9D%A2">Lesson 13 创建一个请求重置密码的界面</a></li>
<li><a href="#lesson-14-%E5%88%A9%E7%94%A8flask-mail%E5%8F%91%E9%80%81%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E7%9A%84%E9%82%AE%E4%BB%B6">Lesson 14 利用flask mail发送重置密码的邮件</a></li>
<li><a href="#lesson-16-flask-sqlalchemy%E4%B8%AD%E7%9A%84%E4%B8%80%E5%AF%B9%E5%A4%9A%E7%9A%84%E8%A1%A8%E6%A0%BC%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93">Lesson 16 Flask SQLAlchemy中的一对多的表格关系数据库</a></li>
<li><a href="#lesson-18">Lesson 18</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://nadineAug.github.io/post/programming-or-git-shi-ji/">
              <h3 class="post-title">
                programming | git识记
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://nadineAug.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
